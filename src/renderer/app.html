<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; style-src 'self' 'unsafe-inline'; script-src 'self' 'unsafe-inline'; img-src 'self' https://og-images.workos.com https://workos.imgix.net data:;" />
    <title>ReysilvaGen</title>
    
    <!-- CSS Assets - Single Entry Point -->
    <link rel="stylesheet" href="assets/css/main.css" />
  </head>
  <body>
    <!-- Application Container -->
    <div id="app-container">
      <!-- Main App Layout -->
      <div id="main-app" class="app" style="display: none;">
        <div id="sidebar-container"></div>
        <div class="main">
          <main class="main__content" id="main-content-container"></main>
          <div id="footer-container"></div>
        </div>
      </div>

      <!-- Admin App Layout -->
      <div id="admin-app" class="app" style="display: none;">
        <div id="admin-login-container"></div>
        <div class="admin-container app" id="admin-panel" style="display: none;">
          <div id="admin-sidebar-container"></div>
          <div class="main">
            <main class="main__content" id="admin-main-content"></main>
          </div>
        </div>
        <div id="admin-modals-container"></div>
      </div>

      <!-- Global Components -->
      <div id="loading-overlay-container"></div>
    </div>

    <!-- Simple Application Bootstrap -->
    <script src="../core/ui/bootstrap.js"></script>
    <script>
      // Simple Application Initialization
      document.addEventListener("DOMContentLoaded", async () => {
        const isAdmin = window.location.hash === "#admin";
        
        // Set document title
        document.title = isAdmin ? "Admin Panel - ReysilvaGen" : "ReysilvaGen - Card Generator";
        
        // Show appropriate layout
        const mainApp = document.getElementById("main-app");
        const adminApp = document.getElementById("admin-app");
        
        if (isAdmin) {
          adminApp.style.display = "flex";
          mainApp.style.display = "none";
        } else {
          mainApp.style.display = "flex";
          adminApp.style.display = "none";
        }
        
        // Load scripts and initialize
        try {
          const mode = isAdmin ? "admin" : "main";
          const loaded = await window.ScriptLoader.init(mode);
          
          if (loaded && !isAdmin) {
            // Initialize main app (AppInit should be available after script loading)
            setTimeout(() => {
              if (window.AppInit) {
                console.log("🚀 Starting main application...");
                window.AppInit.init();
              } else {
                console.error("❌ AppInit not available after script loading");
                console.log("Available globals:", Object.keys(window).filter(k => k.includes('App')));
              }
            }, 200); // Increased timeout to ensure all scripts are loaded
          } else if (loaded && isAdmin) {
            // Initialize admin app
            setTimeout(() => {
              if (window.AdminInit) {
                console.log("🔐 Starting admin application...");
                window.AdminInit.init();
              } else {
                console.error("❌ AdminInit not available");
                // Fallback to admin.js if available
                if (window.AdminApp) {
                  window.AdminApp.init();
                }
              }
            }, 200);
          }
        } catch (error) {
          console.error("❌ Application failed to start:", error);
        }
      });

      // Navigation Functions
      window.goToAdmin = () => {
        window.location.hash = "#admin";
        window.location.reload();
      };

      window.goToMain = () => {
        window.location.hash = "";
        window.location.reload();
      };
    </script>
  </body>
</html>
